<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego de Botellas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      margin-top: 20px;
    }

    #controls {
      margin-top: 10px;
    }

    select, button {
      padding: 5px 10px;
      margin: 0 5px;
      font-size: 16px;
    }

    #boxContainer {
      margin: 20px auto 10px;
      width: fit-content;
      background: #d4a373;
      padding: 30px 10px 10px;
      border: 5px solid #b08968;
      border-radius: 10px;
      position: relative;
      transition: opacity 0.5s ease;
    }

    #container {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      justify-content: center;
      align-items: flex-end;
      min-height: 130px;
    }

    .bottle {
      width: 40px;
      height: 100px;
      border-radius: 10px;
      background: #ccc;
      cursor: grab;
      transition: transform 0.2s ease;
    }

    .bottle.dancing {
      animation: wiggle 0.6s ease-in-out;
    }

    @keyframes wiggle {
      0% { transform: rotate(0); }
      25% { transform: rotate(10deg); }
      50% { transform: rotate(-10deg); }
      75% { transform: rotate(5deg); }
      100% { transform: rotate(0); }
    }

    #finalOrder {
      display: flex;
      justify-content: center;
      margin-top: 10px;
      gap: 10px;
      min-height: 110px;
    }

    #result {
      margin-top: 10px;
      font-weight: bold;
    }

    #resetBtn {
      display: none;
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
    }

    #resetBtn.show {
      display: inline-block;
    }

    canvas#confettiCanvas {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 1000;
    }

  </style>
</head>
<body>

  <h1>Ordena las Botellas</h1>

  <div id="controls">
    Nivel:
    <select id="levelSelect">
      <option value="3">1</option>
      <option value="4">2</option>
      <option value="5">3</option>
    </select>

    Modo:
    <select id="modeSelect">
      <option value="normal">Normal</option>
      <option value="reverse">Inverso</option>
    </select>
  </div>

  <div id="boxContainer">
    <div id="container"></div>
  </div>

  <div id="result"></div>

  <div id="finalOrder"></div>

  <button id="resetBtn">Volver a Jugar</button>

  <canvas id="confettiCanvas"></canvas>
<script>
const victorySound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_a3f1914e86.mp3?filename=success-1-6297.mp3");
const moveSound = new Audio("https://cdn.pixabay.com/download/audio/2022/02/23/audio_f8a3c94bc0.mp3?filename=wood-slide-2-8952.mp3");
moveSound.load();
victorySound.load();

let dragging = null;
const container = document.getElementById("container"),
      result = document.getElementById("result"),
      resetBtn = document.getElementById("resetBtn"),
      finalOrder = document.getElementById("finalOrder"),
      boxContainer = document.getElementById("boxContainer"),
      levelSelect = document.getElementById("levelSelect"),
      modeSelect = document.getElementById("modeSelect"),
      confettiCanvas = document.getElementById("confettiCanvas"),
      ctx = confettiCanvas.getContext("2d");

confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;

let total = parseInt(levelSelect.value),
    correctOrder = [];

function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

function createBottle(idx, total) {
  const div = document.createElement("div");
  div.className = 'bottle';
  div.setAttribute("data-index", idx);
  div.draggable = true;
  const hue = Math.round(idx * (360 / total));
  div.style.background = `hsl(${hue}, 80%, 55%)`;
  return div;
}

function renderGame() {
  dragging = null;
  container.innerHTML = "";
  finalOrder.innerHTML = "";
  boxContainer.style.opacity = "1";
  result.textContent = "";

  total = parseInt(levelSelect.value);
  correctOrder = Array.from({length: total}, (_,i) => i);
  let bottles = correctOrder.map(i => createBottle(i, total));
  bottles = shuffle(bottles);
  bottles.forEach(b => b.classList.add("dancing"));
  setTimeout(() => bottles.forEach(b => b.classList.remove("dancing")), 800);
  bottles.forEach(b => container.appendChild(b));
}

function checkWin() {
  const current = Array.from(container.children).map(c => +c.dataset.index);
  const expected = modeSelect.value === 'reverse' ? [...correctOrder].reverse() : correctOrder;
  let correctCount = current.filter((v,i) => v === expected[i]).length;
  result.textContent = `Botellas correctas: ${correctCount} de ${total}`;

  if (correctCount === total) {
    victorySound.currentTime = 0;
    victorySound.play().catch(() => {});
    boxContainer.style.opacity = "0";
    expected.forEach(i => {
      const b = createBottle(i, total);
      b.style.cursor = "default";
      finalOrder.appendChild(b);
    });
    triggerConfetti();
    resetBtn.classList.add("show");
    if (total < 5) {
      levelSelect.value = total + 1;
      levelSelect.style.background = "#ADD8E6";
    }
  }
}

function triggerConfetti() {
  let confettiPieces = Array.from({length: 100}, () => ({
    x: Math.random() * confettiCanvas.width,
    y: Math.random() * confettiCanvas.height - confettiCanvas.height,
    size: Math.random() * 5 + 5,
    speed: Math.random() * 3 + 2,
    color: `hsl(${Math.random()*360}, 100%, 50%)`
  }));

  function animate() {
    ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    confettiPieces.forEach(p => {
      p.y += p.speed;
      if (p.y > confettiCanvas.height) p.y = -p.size;
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
    });
    requestAnimationFrame(animate);
  }
  animate();
}

container.addEventListener("dragstart", e => {
  if (e.target.classList.contains("bottle")) dragging = e.target;
});
container.addEventListener("dragover", e => {
  e.preventDefault();
  if (!dragging) return;
  const after = [...container.children].find(el => {
    const r = el.getBoundingClientRect();
    return e.clientX < r.left + r.width/2;
  });
  if (after && after !== dragging) container.insertBefore(dragging, after);
  else container.appendChild(dragging);
});
container.addEventListener("dragend", () => {
  moveSound.currentTime = 0;
  moveSound.play().catch(() => {});
  checkWin();
});

resetBtn.addEventListener("click", renderGame);
levelSelect.addEventListener("change", () => {
  renderGame();
  levelSelect.style.background = "";
});
modeSelect.addEventListener("change", renderGame);

renderGame();
</script>
</body>
</html>
