<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego de Botellas Mejorado</title>
  <style>
    body { font-family:'Segoe UI',sans-serif; text-align:center; background:#eef3fb; overflow-x:hidden; user-select:none; }
    h1 { margin:20px 0; }
    #game { display:flex; flex-direction:column; align-items:center; gap:10px; }

    #boxContainer {
      position:relative; width:380px; height:200px;
      background:linear-gradient(145deg,#d6b887,#c1a663);
      border:3px solid #a17a38; border-radius:10px;
      box-shadow:inset 0 6px 8px #b99957,0 8px 12px rgba(0,0,0,0.2);
      overflow:hidden;
    }

    #container { display:flex; justify-content:center; gap:20px; position:absolute;
      top:20px; width:100%; transition:transform .8s; }

    #finalOrder { display:flex; justify-content:center; gap:20px; margin-top:220px;
      opacity:0; transition:opacity 1s; pointer-events:none; }

    .bottle {
      width:60px; height:120px; border-radius:15px 15px 40px 40px;
      border:3px solid #333; background:linear-gradient(145deg,#c4dcff,#4367d8);
      box-shadow:inset 0 8px 15px rgba(255,255,255,.8),0 8px 15px rgba(0,0,0,.3);
      transition:transform .4s,opacity .4s; cursor:grab; user-select:none;
    }
    .bottle::before {
      content:''; position:absolute; top:-15px; left:50%; transform:translateX(-50%);
      width:25px;height:20px;
      background:linear-gradient(145deg,#a0b9f5,#334db2);
      border-radius:12px 12px 5px 5px;
      box-shadow:inset 0 2px 4px rgba(255,255,255,.6);
    }
    .dancing { animation:dance .5s infinite alternate; }
    @keyframes dance { 0%{transform:rotate(-3deg) translateY(-4px);}100%{transform:rotate(3deg) translateY(4px);} }

    #resetBtn {
      margin-top:10px; padding:12px 28px; font-size:1.2rem; color:white;
      background:linear-gradient(145deg,#2980b9,#1c5980); border:none;border-radius:30px;
      box-shadow:0 4px 8px rgba(41,128,185,.7);
      opacity:0; pointer-events:none; transition:opacity .7s;
    }
    #resetBtn.show { opacity:1; pointer-events:auto; animation:pulse 1.5s infinite alternate; }
    @keyframes pulse { 0%{transform:scale(1);}100%{transform:scale(1.1);} }

    #result {
      margin-top:10px; font-size:1.3rem; font-weight:600; min-height:1.5em;
      transition:color .5s;
    }

    canvas {
      position:fixed; top:0; left:0; z-index:20; pointer-events:none;
      opacity:1; transition:opacity 2s;
    }
    .slide-up { transform:translateY(0); }
    .slide-down { transform:translateY(180px); }
  </style>
</head>
<body>
  <h1>Ordena las Botellas ðŸ§ª</h1>
  <div id="game">
    <div id="boxContainer">
      <div id="container" class="slide-up"></div>
    </div>
    <p id="result"></p>
    <div id="finalOrder"></div>
    <button id="resetBtn">Volver a jugar</button>
  </div>

  <audio id="winSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>
  <canvas id="confettiCanvas"></canvas>

  <script>
  const COLORS=["#e74c3c","#2980b9","#27ae60","#f39c12","#8e44ad"];
  let correctOrder=[], currentOrder=[];

  const container=...document.getElementById("container"),
        finalOrder=...document.getElementById("finalOrder"),
        result=...document.getElementById("result"),
        resetBtn=...document.getElementById("resetBtn"),
        canvas=...document.getElementById("confettiCanvas"),
        ctx=canvas.getContext("2d"),
        winSound=...document.getElementById("winSound");

  function shuffle(a){return a.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);}
  function shadeColor(c,p){let f=parseInt(c.slice(1),16),R=f>>16,G=f>>8&0xFF,B=f&0xFF;
    return "#"+(0x1000000+((Math.round((0-R)*p/100)+R)<<16)+((Math.round((0-G)*p/100)+G)<<8)+(Math.round((0-B)*p/100)+B)).toString(16).slice(1);
  }
  function applyColor(el,color){
    el.style.background=`linear-gradient(145deg, ${shadeColor(color,40)}, ${color})`;
    el.dataset.color=color;
  }

  function createBottles(){
    correctOrder=[...COLORS]; currentOrder=shuffle([...COLORS]);
    container.innerHTML=""; finalOrder.innerHTML="";
    finalOrder.style.opacity=0; result.textContent="";
    result.style.color="#334db2"; resetBtn.classList.remove("show");
    container.classList.replace("slide-down","slide-up");

    currentOrder.forEach(c=>{
      const d=document.createElement("div"); d.className="bottle"; applyColor(d,c);
      d.draggable=true;
      ["dragstart","dragover","drop","dragend"].forEach(ev=>d.addEventListener(ev, window[ev]));
      container.appendChild(d);
    });
    correctOrder.forEach(c=>{
      const d=document.createElement("div"); d.className="bottle"; applyColor(d,c);
      finalOrder.appendChild(d);
    });
  }

  let dragged=null;
  function dragstart(e){ dragged=e.target; dragged.classList.add("dancing"); setTimeout(()=>dragged.style.opacity="0.6",0); }
  function dragover(e){ e.preventDefault(); }
  function drop(e){
    e.preventDefault();
    const tgt=e.target.closest(".bottle");
    if(!tgt||tgt===dragged)return;
    const c1=dragged.dataset.color, c2=tgt.dataset.color;
    applyColor(dragged,c2); applyColor(tgt,c1);
    updateCurrentOrder();
  }
  function dragend(e){
    if(dragged){
      dragged.classList.remove("dancing"); dragged.style.opacity="1"; dragged=null;
      checkOrder();
    }
  }
  function updateCurrentOrder(){ currentOrder=[...container.children].map(d=>d.dataset.color); }
  function checkOrder(){
    let correctCount=currentOrder.filter((c,i)=>c===correctOrder[i]).length;
    result.textContent=`Botellas correctas: ${correctCount} de ${correctOrder.length}`;
    result.style.color = correctCount===5 ? "green" : (correctCount>=3? "orange" : "red");
    if(correctCount===5){
      result.textContent+=" âœ… Â¡Ganaste!";
      container.classList.replace("slide-up","slide-down");
      finalOrder.style.opacity=1;
      launchConfetti();
      winSound.play();
      resetBtn.classList.add("show");
    }
  }

  function launchConfetti(){
    canvas.width=innerWidth; canvas.height=innerHeight;
    let pieces=Array.from({length:100}, _=>({
      x:Math.random()*canvas.width,
      y:Math.random()*-canvas.height,
      speed:Math.random()*3+2,
      r:Math.random()*6+4,
      color:COLORS[Math.floor(Math.random()*COLORS.length)]
    }));
    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      pieces.forEach(p=>{
        ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,2*Math.PI);
        ctx.fillStyle=p.color;ctx.fill();p.y+=p.speed;
        if(p.y>canvas.height)p.y=-20;
      });
      requestAnimationFrame(draw);
    }
    draw();
    setTimeout(()=>{canvas.style.opacity=0; setTimeout(()=>canvas.style.display="none",2000);},3000);
  }

  resetBtn.addEventListener("click",()=>{
    resetBtn.classList.remove("show"); result.textContent="";
    finalOrder.style.opacity=0;
    container.classList.replace("slide-down","slide-up");
    setTimeout(createBottles,800);
  });

  createBottles();
  </script>
</body>
</html>
